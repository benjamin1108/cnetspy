# CloudNetSpy Nginx 配置
# 站点: cnetspy.site
# 路径: /next/

# 添加到现有 cnetspy.site server 块中：

# /next/ 前端静态文件
location /next/ {
    alias /home/benjamin/cnetspy-deploy/;
    try_files $uri $uri/ /next/index.html;
    
    # 静态资源缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}

# /next/api/ 代理 API
location /next/api/ {
    proxy_pass http://127.0.0.1:8088/api/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

# MCP SSE 端点
location /next/sse {
    proxy_pass http://127.0.0.1:8089/sse;
    proxy_http_version 1.1;
    proxy_set_header Connection '';
    proxy_set_header Cache-Control 'no-cache';
    proxy_set_header X-Accel-Buffering 'no';
    proxy_buffering off;
    proxy_read_timeout 86400s;
    chunked_transfer_encoding off;
}

# MCP messages 端点
location /next/messages/ {
    proxy_pass http://127.0.0.1:8089/messages/;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
}
